```markdown
# vCluster 103 — Multi-Tenancy Isolation via Same Application Names

This scenario will demonstrate how multi-tenancy works with vCluster. We will:

- Create two virtual clusters
- Deploy my-app into each vCluster
- 

You will create two vClusters, deploy the same app and service names into both, expose them, and confirm they operate independently.


## STEP 1 — Overview

This scenario demonstrates that vClusters provide isolated control planes. Two tenants can use identical resource names (Deployments, Services) without colliding on the host cluster.

We'll create two vClusters: `my-vcluster-a` and `my-vcluster-b` (both in namespace `team-x`). Then we'll deploy the same application and service name `web` in both and expose them.

============================================================

## STEP 2 — Create two vClusters

Create two vClusters in the `team-x` namespace. We'll name them `my-vcluster-a` and `my-vcluster-b`.

`kubectl create namespace team-x 2>/dev/null || true`{{exec}}

`vcluster create my-vcluster-a --namespace team-x`{{exec}}

`vcluster create my-vcluster-b --namespace team-x`{{exec}}

Verify both are running with `vcluster list`.

============================================================

## STEP 3 — Deploy the same app name in both vClusters

We'll deploy a simple nginx Deployment named `web` in each vCluster's `default` namespace.

Connect to the first vCluster and deploy:

`vcluster connect my-vcluster-a --namespace team-x`{{exec}}

`kubectl create deployment web --image=nginx --replicas=1`{{exec}}

`kubectl expose deployment web --port=80 --target-port=80 --type=ClusterIP`{{exec}}

Disconnect and repeat for the second vCluster:

`vcluster disconnect`{{exec}}

`vcluster connect my-vcluster-b --namespace team-x`{{exec}}

`kubectl create deployment web --image=nginx --replicas=1`{{exec}}

`kubectl expose deployment web --port=80 --target-port=80 --type=ClusterIP`{{exec}}

`vcluster disconnect`{{exec}}

============================================================

## STEP 4 — Expose both apps

We will expose each `web` service so they can be reached independently.

Option A: NodePort (if allowed): connect to each vCluster and patch the service to NodePort.

`vcluster connect my-vcluster-a --namespace team-x`{{exec}}

`kubectl patch svc web -p '{"spec": {"type": "NodePort"}}'`{{exec}}

`vcluster disconnect`{{exec}}

`vcluster connect my-vcluster-b --namespace team-x`{{exec}}

`kubectl patch svc web -p '{"spec": {"type": "NodePort"}}'`{{exec}}

`vcluster disconnect`{{exec}}

Option B: port-forward locally from each vCluster context (works everywhere):

`vcluster connect my-vcluster-a --namespace team-x`{{exec}}

`kubectl port-forward svc/web 18080:80 &`{{exec}}

`vcluster disconnect`{{exec}}

`vcluster connect my-vcluster-b --namespace team-x`{{exec}}

`kubectl port-forward svc/web 28080:80 &`{{exec}}

`vcluster disconnect`{{exec}}

============================================================

## STEP 5 — Verify independent access

Now that both services are exposed (NodePort or port-forward), access them to prove they are independent.

If you used port-forward:

`curl -s http://localhost:18080 | head -n 1`{{exec}}

`curl -s http://localhost:28080 | head -n 1`{{exec}}

If NodePort was used, use the node IP and corresponding NodePort shown in step 4.

============================================================

## STEP 6 — Cleanup & Wrap-up

Remove the resources and vClusters when done.

Delete deployments/services inside vClusters then delete the vClusters themselves:

`vcluster connect my-vcluster-a --namespace team-x`{{exec}}

`kubectl delete svc,deployment -l app=web --ignore-not-found`{{exec}}

`vcluster disconnect`{{exec}}

`vcluster connect my-vcluster-b --namespace team-x`{{exec}}

`kubectl delete svc,deployment -l app=web --ignore-not-found`{{exec}}

`vcluster disconnect`{{exec}}

Delete the virtual clusters from the host:

`vcluster delete my-vcluster-a --namespace team-x`{{exec}}

`vcluster delete my-vcluster-b --namespace team-x`{{exec}}

Thank you — you successfully demonstrated same-name isolation with vClusters.

============================================================

Congratulations — you saw how vClusters let tenants run identical application and service names independently.

You created two vClusters, deployed the same application and service name into each, exposed them, and verified independent access.

Cleanup: remove vClusters with `vcluster delete my-vcluster-a --namespace team-x` and `vcluster delete my-vcluster-b --namespace team-x`.

```
